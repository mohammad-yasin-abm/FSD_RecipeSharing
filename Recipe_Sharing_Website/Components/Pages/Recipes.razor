@page "/recipes"
 

@using Microsoft.EntityFrameworkCore
@using Recipe_Sharing_Website.Data
@using Recipe_Sharing_Website.Models

@inject IDbContextFactory<AppDbContext> DbFactory

<h3>Recipes</h3>

@if (!string.IsNullOrWhiteSpace(_error))
{
    <div class="alert alert-danger">@_error</div>
}

@if (_recipes is null && string.IsNullOrWhiteSpace(_error))
{
    <p>Loading recipes...</p>
}
else if (_recipes is not null && _recipes.Count == 0)
{
    <p>No recipes available.</p>
}
else if (_recipes is not null)
{
    <ul>
        @foreach (var r in _recipes)
        {
            <li><a href="/recipes/@r.RecipeId">@r.Title</a></li>
        }
    </ul>
}

@code {
    private List<Recipe>? _recipes;
    private string? _error;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            await using var db = await DbFactory.CreateDbContextAsync();

            _recipes = await db.Recipes
                .AsNoTracking()
                .OrderByDescending(r => r.RecipeId)
                .ToListAsync();
        }
        catch (Exception ex)
        {
            _error = ex.ToString();
        }
    }
}
